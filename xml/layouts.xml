<?xml version="1.0" encoding="UTF-8"?>

<layouts>
  <package>org.xidget.layout.xaction</package>
  
  <vfree>
    <assign name="xidgets">*[ @xidget]</assign>
    <assign name="n">count( $xidgets)</assign>
    
    <assign name="lpad">number( layout/spacing/@left | layout/spacing/left | layout/spacing)</assign>
    <assign name="tpad">number( layout/spacing/@top | layout/spacing/top | layout/spacing)</assign>
    <assign name="rpad">number( layout/spacing/@right | layout/spacing/right | layout/spacing)</assign>
    <assign name="bpad">number( layout/spacing/@bottom | layout/spacing/bottom | layout/spacing)</assign>
    <assign name="between">number( layout/spacing/@peer | layout/spacing/peer | layout/spacing)</assign>
    
    <attach xidget="$xidgets[ 1]">
      <top constant="$tpad"/>
      <left constant="$lpad"/>
      <right anchor="width" offset="-$rpad"/>
    </attach>
    
    <for assign="i" from="2" to="$n + 1" by="1">
      <attach xidget="$xidgets[ $i]">
        <top attach="$xidgets[ $i - 1]" anchor="bottom" offset="$between"/>
        <left constant="$lpad"/>
        <right anchor="width" offset="-$rpad"/>
      </attach>
    </for>
    
    <attach xidget=".">
      <width attach="$xidgets[ $n]" anchor="right" offset="$rpad"/>
      <height attach="$xidgets[ $n]" anchor="bottom" offset="$bpad"/>
    </attach>
  </vfree>
  
  <vgrid>
    <assign name="xidgets">*[ @xidget]</assign>
    <assign name="n">count( $xidgets)</assign>
    
    <assign name="lpad">number( layout/spacing/@left | layout/spacing/left | layout/spacing)</assign>
    <assign name="tpad">number( layout/spacing/@top | layout/spacing/top | layout/spacing)</assign>
    <assign name="rpad">number( layout/spacing/@right | layout/spacing/right | layout/spacing)</assign>
    <assign name="bpad">number( layout/spacing/@bottom | layout/spacing/bottom | layout/spacing)</assign>
    <assign name="between">number( layout/spacing/@peer | layout/spacing/peer | layout/spacing)</assign>
    <assign name="before">$between div 2</assign>
    <assign name="after">$between - $before</assign>
    
    <attach xidget="$xidgets[ 1]">
      <top constant="$tpad"/>
      <left constant="$lpad"/>
      <right anchor="width" offset="-$rpad"/>
      <bottom percent="1 div $n" anchor="height" offset="-$before"/>
    </attach>
    
    <for assign="i" from="2" to="$n" by="1">
      <attach xidget="$xidgets[ $i]">
        <top percent="($i - 1) div $n" anchor="height" offset="$after"/>
        <left constant="$lpad"/>
        <right anchor="width" offset="-$rpad"/>
        <bottom percent="$i div $n" anchor="height" offset="-$before"/>
      </attach>
    </for>
    
    <attach xidget="$xidgets[ $n]">
      <top percent="($n - 1) div $n" anchor="height" offset="$after"/>
      <left constant="$lpad"/>
      <right anchor="width" offset="-$rpad"/>
      <bottom anchor="height" offset="-$bpad"/>
    </attach>
  </vgrid>
</layouts>