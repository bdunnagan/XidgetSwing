<?xml version="1.0" encoding="UTF-8"?>

<layouts>
  <package>org.xidget.layout.xaction</package>
  
  <vfree>
    <assign name="xidgets">*[ @xidget]</assign>
    <assign name="n">count( $xidgets)</assign>
    <assign name="s">ancestor-or-self::*/@spacing</assign>
    <parseInsets prefix="m">ancestor-or-self::*/@margins</parseInsets>

    <for assign="xidget" source="$xidgets">
      <attach xidget="$xidget">
        <left offset="$ml"/>
        <right offset="-$mr"/>
      </attach>
    </for>
    
    <attach xidget="$xidgets[ 1]">
      <top offset="$mt"/>
    </attach>
        
    <for assign="i" from="2" to="$n+1" by="1">
      <attach xidget="$xidgets[ $i]">
        <top attach="$xidgets[ $i - 1]" anchor="bottom" offset="$s" handle="@handles"/>
      </attach>  
    </for>
    
    <attach xidget=".">
      <height attach="$xidgets[ $n]" anchor="bottom" offset="$mb"/>
    </attach>
  </vfree>
    
  <vgrid>
    <assign name="xidgets">*[ @xidget]</assign>
    <assign name="n">count( $xidgets)</assign>
    
    <assign name="s">ancestor-or-self::*/@spacing</assign>
    <parseInsets prefix="m">ancestor-or-self::*/@margins</parseInsets>
    
    <assign name="before">if ($n &gt; 1) then ($s div 2) else (0)</assign>
    
    <for assign="x" source="$xidgets">
      <attach xidget="$x">
        <left offset="$ml"/>
        <right offset="-$mr"/>
      </attach>
    </for>
    
    <attach xidget="$xidgets[ 1]">
      <top offset="$mt"/>
    </attach>
    
    <attach xidget="$xidgets[ $n]">
      <bottom offset="-$mb"/>
    </attach>

    <for assign="i" from="2" to="$n+1" by="1">
      <assign name="y">($i - 1) div $n</assign>
      <attach xidget="$xidgets[ $i - 1]">
        <bottom anchor="height" percent="$y" offset="-$before" handle="@handles"/>
      </attach>
      <attach xidget="$xidgets[ $i]">
        <top attach="$xidgets[ $i - 1]" anchor="bottom" offset="$s"/>
      </attach>
    </for>
  </vgrid>
  
  <hfree>
    <assign name="xidgets">*[ @xidget]</assign>
    <assign name="n">count( $xidgets)</assign>
    <assign name="s">ancestor-or-self::*/@spacing</assign>
    <parseInsets prefix="m">ancestor-or-self::*/@margins</parseInsets>

    <for assign="xidget" source="$xidgets">
      <attach xidget="$xidget">
        <top offset="$mt"/>
        <bottom offset="-$mb"/>
      </attach>
    </for>
    
    <attach xidget="$xidgets[ 1]">
      <left offset="$ml"/>
    </attach>
        
    <for assign="i" from="2" to="$n+1" by="1">
      <attach xidget="$xidgets[ $i]">
        <left attach="$xidgets[ $i - 1]" anchor="right" offset="$s" handle="@handles"/>
      </attach>  
    </for>
    
    <attach xidget=".">
      <width attach="$xidgets[ $n]" anchor="right" offset="$mr"/>
    </attach>
  </hfree>
    
  <hgrid>
    <assign name="xidgets">*[ @xidget]</assign>
    <assign name="n">count( $xidgets)</assign>
    
    <assign name="s">ancestor-or-self::*/@spacing</assign>
    <parseInsets prefix="m">ancestor-or-self::*/@margins</parseInsets>
    
    <assign name="before">if ($n &gt; 1) then ($s div 2) else (0)</assign>
    
    <for assign="x" source="$xidgets">
      <attach xidget="$x">
        <top offset="$mt"/>
        <bottom offset="-$mb"/>
      </attach>
    </for>
    
    <attach xidget="$xidgets[ 1]">
      <left offset="$ml"/>
    </attach>
    
    <attach xidget="$xidgets[ $n]">
      <right offset="-$mr"/>
    </attach>

    <for assign="i" from="2" to="$n+1" by="1">
      <assign name="y">($i - 1) div $n</assign>
      <attach xidget="$xidgets[ $i - 1]">
        <right anchor="width" percent="$y" offset="-$before" handle="@handles"/>
      </attach>
      <attach xidget="$xidgets[ $i]">
        <left attach="$xidgets[ $i - 1]" anchor="right" offset="$s"/>
      </attach>
    </for>
  </hgrid>
</layouts>